<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/index}">

<head>
  <meta charset="UTF-8">
  <title>출고 관리</title>
</head>

<body>
  <div layout:fragment="content">




    <!-- Content wrapper -->
    <div class="content-wrapper">
      <!-- Content -->
      <div class="container-xxl flex-grow-1 container-p-y">
        <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">영업 관리 /</span> 주문 출고 관리</h4>

        <div class="col-xl-6" style="width: 100%;">
          <div class="nav-align-top mb-4">
            <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item">
                <button type="button" class="nav-link active" role="tab" data-bs-toggle="tab"
                  data-bs-target="#navs-top-home" aria-controls="navs-top-home" aria-selected="true">
                  미처리
                </button>
              </li>
              <li class="nav-item">
                <button type="button" class="nav-link" role="tab" data-bs-toggle="tab"
                  data-bs-target="#navs-top-profile" aria-controls="navs-top-profile" aria-selected="false">
                  처리
                </button>
              </li>

            </ul>
            <div class="tab-content">
              <div class="tab-pane fade show active" id="navs-top-home" role="tabpanel">

                <form id="nSendSearch" method="post">

                  <div class="card-body">
                    <div class="row">

                      <div class="mb-3 row col-md-6">
                        <label for="html5-search-input" class="col-md-3 col-form-label">거래처 코드</label>
                        <div class="col-md-9">
                          <input class="form-control" type="search" id="nCliCd" placeholder="거래처 코드">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">

                      </div>
                      <div class="mb-3 row col-md-6">
                        <label for="html5-search-input" class="col-md-3 col-form-label">거래처명</label>
                        <div class="col-md-9">
                          <input class="form-control" type="search" id="nCliName" placeholder="거래처 이름">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">

                      </div>


                      <div class="mb-3 row col-md-6">
                        <label for="html5-date-input" class="col-md-3 col-form-label">주문일</label>
                        <div class="col-md-9">
                          <input class="form-control" type="date" id="nMinOdDt" value="">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">
                        <label for="html5-date-input" class="col-md-1 col-form-label">~</label>
                        <div class="col-md-9">
                          <input class="form-control" type="date" id="nMaxOdDt">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">
                        <label for="html5-date-input" class="col-md-3 col-form-label">납기일</label>
                        <div class="col-md-9">
                          <input class="form-control" type="date" id="nMinDueDt">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">
                        <label for="html5-date-input" class="col-md-1 col-form-label">~</label>
                        <div class="col-md-9">
                          <input class="form-control" type="date" id="nMaxDueDt" placeholder="231465">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">
                        <label for="html5-search-input" class="col-md-3 col-form-label">주문 담당자명</label>
                        <div class="col-md-9">
                          <input class="form-control" type="search" id="nOdChg" placeholder="거래처 담당자 이름">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">

                      </div>

                    </div>

                    <div class="mb-3 row col-md-6">
                      <label for="html5-date-input" class="col-md-3 col-form-label"></label>
                      <div class="col-md-9">
                        <button type="submit" class="btn btn-primary me-2" id="nSearchBtn">검색</button>
                        <button type="reset" class="btn btn-outline-secondary" id="nResetBtn">초기화</button>
                      </div>
                    </div>

                  </div>
                </form>


                
                <!-- 미출고 목록 그리드 -->
                <div id="notSendTable" class="mb-3">

                </div>

              </div>


              <div class="tab-pane fade" id="navs-top-profile" role="tabpanel">

                <form id="sendSearch">

                  <div class="card-body">
                    <div class="row">

                      <div class="mb-3 row col-md-6">
                        <label for="html5-search-input" class="col-md-3 col-form-label">거래처 코드</label>
                        <div class="col-md-9">
                          <input class="form-control" type="search" id="sCliCd" placeholder="거래처 코드">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">

                      </div>
                      <div class="mb-3 row col-md-6">
                        <label for="html5-search-input" class="col-md-3 col-form-label">거래처명</label>
                        <div class="col-md-9">
                          <input class="form-control" type="search" id="sCliName" placeholder="거래처 이름">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">

                      </div>


                      <div class="mb-3 row col-md-6">
                        <label for="html5-date-input" class="col-md-3 col-form-label">주문일</label>
                        <div class="col-md-9">
                          <input class="form-control" type="date" id="sMinOdDt" value="">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">
                        <label for="html5-date-input" class="col-md-1 col-form-label">~</label>
                        <div class="col-md-9">
                          <input class="form-control" type="date" id="sMaxOdDt">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">
                        <label for="html5-date-input" class="col-md-3 col-form-label">납기일</label>
                        <div class="col-md-9">
                          <input class="form-control" type="date" id="sMinDueDt">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">
                        <label for="html5-date-input" class="col-md-1 col-form-label">~</label>
                        <div class="col-md-9">
                          <input class="form-control" type="date" id="sMaxDueDt" placeholder="231465">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">
                        <label for="html5-search-input" class="col-md-3 col-form-label">주문 담당자명</label>
                        <div class="col-md-9">
                          <input class="form-control" type="search" id="sOdChg" placeholder="거래처 담당자 이름">
                        </div>
                      </div>
                      <div class="mb-3 row col-md-6">

                      </div>

                    </div>

                    <div class="mb-3 row col-md-6">
                      <label for="html5-date-input" class="col-md-3 col-form-label"></label>
                      <div class="col-md-9">
                        <button type="submit" class="btn btn-primary me-2" id="sSearchBtn">검색</button>
                        <button type="reset" class="btn btn-outline-secondary" id="sResetBtn">초기화</button>
                      </div>
                    </div>

                  </div>
                </form>
                <!-- 출고 목록 그리드 -->
                <div id="sendTable" class="mb-3">

                </div>

              </div>

            </div>
          </div>
        </div>
      </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      //sendSearch.addEventListener("submit", onSendSubmit);

      let nSendCondition = { sendStList : 1 }
      let sendCondition = { sendSt : [2, 3] }
      getOdList(nSendCondition);
      getOdList(sendCondition);

      // 미처리된 출고목록 조건검색
      nSendSearch.onsubmit = async (e) => {
        e.preventDefault();
        console.log('미처리 조건검색')
        //let param = new FormData(document.sendSearch);        

        const cliCd = nSendSearch.nCliCd.value;
        const cliName = nSendSearch.nCliName.value;
        const minOdDt = nSendSearch.nMinOdDt.value;
        const maxOdDt = nSendSearch.nMaxOdDt.value;
        const minDueDt = nSendSearch.nMinDueDt.value;
        const maxDueDt = nSendSearch.nMaxDueDt.value;
        const odChg = nSendSearch.nOdChg.value;
        const sendStList = [1]

        let condition = { cliCd, cliName, minOdDt, maxOdDt, minDueDt, maxDueDt, odChg, sendStList };
        console.log(condition);
        
        getOdList(condition);
      }

      // 처리된 출고목록 조건검색
      sendSearch.onsubmit = async (e) => {
        e.preventDefault();
        console.log('처리 조건검색')

        //let param = new FormData(document.sendSearch);        

        const cliCd = sendSearch.sCliCd.value;
        const cliName = sendSearch.sCliName.value;
        const minOdDt = sendSearch.sMinOdDt.value;
        const maxOdDt = sendSearch.sMaxOdDt.value;
        const minDueDt = sendSearch.sMinDueDt.value;
        const maxDueDt = sendSearch.sMaxDueDt.value;
        const odChg = sendSearch.sOdChg.value;
        const sendStList = [ 2,3 ];

        let condition = { cliCd, cliName, minOdDt, maxOdDt, minDueDt, maxDueDt, odChg, sendStList };
        console.log(condition);
        
        getOdList(condition);
      }

      // 출고/미출고 주문(제품별)목록 불러오기
      function getOdList(condition){
        let param = condition;
        axios.post("/sales/ajax/sendSearch", param )
             .then(res=> console.log(res))
      }


      var table = new Tabulator("#notSendTable", {
        layout: "fitColumns",
        height: "100%",
        //responsiveLayout: "hide",
        rowHeader: { formatter: "rownum", headerSort: false, width: 70, hozAlign: "center", resizable: false, frozen: true },
        resizableColumnFit: true,
        layout: "fitColumns",
        columns: [ //주문일, 거래처, 제품명, 주문금액(부분합), 납기일, 상태, 인쇄
          { title: "주문번호", field: "odNo", width: 70, hozAlign: "center" },
          { title: "주문일", field: "odDt", width: 90, hozAlign: "center" },
          { title: "거래처", field: "cliName", width: 120, hozAlign: "center" },
          { title: "거래처 담당자", field: "cliChg", width: 100, hozAlign: "center" },
          { title: "제품", field: "pd", width: 400, hozAlign: "center" },
          { title: "할인율", field: "dcRate", width: 50, hozAlign: "center" },
          { title: "총 금액", field: "totalPrice", width: 90, hozAlign: "center" },
          { title: "주문 담당자", field: "odChg", width: 80, hozAlign: "center" },
          { title: "납기일", field: "dueDt", width: 90, hozAlign: "center" },
          { title: "주문상태", field: "st", width: 100, hozAlign: "center" },
          // { title: "인쇄", field: "week", width: 160, hozAlign: "center" }
        ],
      });

      var table = new Tabulator("#sendTable", {
        layout: "fitColumns",
        height: "100%",
        //responsiveLayout: "hide",
        rowHeader: { formatter: "rownum", headerSort: false, width: 70, hozAlign: "center", resizable: false, frozen: true },
        resizableColumnFit: true,
        layout: "fitColumns",
        columns: [ //주문일, 거래처, 제품명, 주문금액(부분합), 납기일, 상태, 인쇄
          { title: "주문번호", field: "odNo", width: 70, hozAlign: "center" },
          { title: "주문일", field: "odDt", width: 90, hozAlign: "center" },
          { title: "거래처", field: "cliName", width: 120, hozAlign: "center" },
          { title: "거래처 담당자", field: "cliChg", width: 100, hozAlign: "center" },
          { title: "제품", field: "pd", width: 400, hozAlign: "center" },
          { title: "할인율", field: "dcRate", width: 50, hozAlign: "center" },
          { title: "총 금액", field: "totalPrice", width: 90, hozAlign: "center" },
          { title: "주문 담당자", field: "odChg", width: 80, hozAlign: "center" },
          { title: "납기일", field: "dueDt", width: 90, hozAlign: "center" },
          { title: "주문상태", field: "st", width: 100, hozAlign: "center" },
          // { title: "인쇄", field: "week", width: 160, hozAlign: "center" }
        ],
      });

    </script>
  </div>


</body>

</html>