<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/index}">

<head>
    <meta charset="UTF-8">
    <title>제품 재고 관리</title>
</head>

<body>
    <div layout:fragment="content">
        <!-- Content wrapper -->
        <div class="content-wrapper">
            <!-- Content -->

            <div class="container-xxl flex-grow-1 container-p-y">
                <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">영업 관리 /</span> 제품 재고</h4>


                <!-- 주문목록 그리드 -->
                <div id="pdStockTable" class="mb-3">

                </div>

                <!-- <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light"></span>LOT 재고</h4> -->




                <div class="card mb-4" style="margin-top: 100px;">
                    <h5 class="card-header">LOT 재고 검색</h5>
                    <div class="card-body">
                        <!-- <form id="formAccountSettings" method="POST" onsubmit="return false"> -->
                        <div class="row">



                            <div class="mb-3 row col-md-6">
                                <label for="html5-search-input" class="col-md-3 col-form-label">LOT</label>
                                <div class="col-md-9">
                                    <input class="form-control" type="search" id="lot" placeholder="거래처 코드">
                                </div>
                            </div>
                            <div class="mb-3 row col-md-6">
                                <label for="pdCd" class="col-md-3 col-form-label"></label>
                                <div class="col-md-9">
                                    
                                </div>
                            </div>
                            <div class="mb-3 row col-md-6">
                                <label for="html5-search-input" class="col-md-3 col-form-label">제품코드</label>
                                <div class="col-md-9">
                                    <input class="form-control" type="search" id="pdCd" placeholder="거래처 이름">
                                </div>
                            </div>
                            <div class="mb-3 row col-md-6">
                                <label for="html5-search-input" class="col-md-3 col-form-label">제품명</label>
                                <div class="col-md-9">
                                    <input class="form-control" type="search" id="pdName" placeholder="제품명">
                                </div>
                            </div>
                            

                            <div class="mb-3 row col-md-6">
                                <label for="html5-date-input" class="col-md-3 col-form-label">생산일</label>
                                <div class="col-md-9">
                                    <input class="form-control" type="date" id="minOdDt">
                                </div>
                            </div>
                            <div class="mb-3 row col-md-6">
                                <label for="html5-date-input" class="col-md-1 col-form-label">~</label>
                                <div class="col-md-9">
                                    <input class="form-control" type="date" id="maxOdDt">
                                </div>
                            </div>
                            <div class="mb-3 row col-md-6">
                                <label for="html5-date-input" class="col-md-3 col-form-label">유통기한</label>
                                <div class="col-md-9">
                                    <input class="form-control" type="date" id="minDueDt">
                                </div>
                            </div>
                            <div class="mb-3 row col-md-6">
                                <label for="html5-date-input" class="col-md-1 col-form-label">~</label>
                                <div class="col-md-9">
                                    <input class="form-control" type="date" id="maxDueDt" placeholder="231465">
                                </div>
                            </div>






                        </div>



                    </div>



                    <!-- <div class="mt-2"> -->
                    <div class="mb-3 row col-md-6">
                        <label for="html5-date-input" class="col-md-3 col-form-label"></label>
                        <div class="col-md-9">
                            <button type="submit" class="btn btn-primary me-2" id="searchBtn">검색</button>
                            <button type="reset" class="btn btn-outline-secondary" id="resetBtn">초기화</button>
                        </div>
                    </div>
                    <div class="mb-3 row col-md-6">
                        <label for="html5-date-input" class="col-md-1 col-form-label"></label>
                        <div class="col-md-9">
                        </div>
                        <!-- </div> 아래 버튼으로 대체 예정-->

                        <!-- <div class="mt-2">
                          <button type="submit" class="btn btn-primary me-2">검색</button>
                          <button type="reset" class="btn btn-outline-secondary">초기화</button>
                        </div> -->


                        </form>
                    </div>
                </div>



                <!-- 주문목록 그리드 -->
                <div id="lotStockTable" class="mb-3">

                </div>



            </div>
        </div>



        <script>
            // 체크한 주문상태를 담을 배열 선언
            let stList = [];

            // 검색 조건 초기화
            resetBtn.addEventListener("click", e => {
                document.getElementById('cliCd').value = null;
                document.getElementById('cliName').value = null;
                document.getElementById('cliChg').value = null;
                document.getElementById('pdCd').value = null;
                document.getElementById('pdName').value = null;
                document.getElementById('odChg').value = null;
                document.getElementById('minOdDt').value = null;
                document.getElementById('maxOdDt').value = null;
                document.getElementById('minDueDt').value = null;
                document.getElementById('maxDueDt').value = null;
                stList = null;
            })

            // 검색 버튼 누르면 조건대로 검색한 주문목록 불러오기
            searchBtn.addEventListener("click", e => {
                checkList();

                let cliCd = document.getElementById('cliCd').value;
                let cliName = document.getElementById('cliName').value;
                let cliChg = document.getElementById('cliChg').value;
                let pdCd = document.getElementById('pdCd').value;
                let pdName = document.getElementById('pdName').value;
                let odChg = document.getElementById('odChg').value;
                let minOdDt = document.getElementById('minOdDt').value;
                let maxOdDt = document.getElementById('maxOdDt').value;
                let minDueDt = document.getElementById('minDueDt').value;
                let maxDueDt = document.getElementById('maxDueDt').value;

                if (stList.length == 0) {
                    stList = null;
                }

                let param = { cliCd, cliName, cliChg, pdCd, pdName, odChg, minOdDt, maxOdDt, minDueDt, maxDueDt, stList }

                console.log(param);
                fetch("/sales/ajax/orderMng", {
                    method: "post",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(param)
                })
                    .then(res => res.json())
                    .then(res => table.setData(res))




            })

            // 조건검색 : 체크된 주문상태만 배열에 담기
            function checkList() {
                // 주문상태 배열 초기화
                stList = [];

                // Name이 odSt인 속성 취득
                const odSt = document.getElementsByName("odSt");
                // 취득한 속성 만큼 루프
                for (let i = 0; i < odSt.length; i++) {
                    // 속성중에 체크 된 항목이 있을 경우
                    if (odSt[i].checked == true) {
                        stList.push(odSt[i].value);
                    }
                }
            }




            var pdStockTable = new Tabulator("#pdStockTable", {
                // layout:"fitColumns",
                height: "100%",
                responsiveLayout: "hide",
                rowHeader: { formatter: "rownum", headerSort: false, width: 70, hozAlign: "center", resizable: false, frozen: true },
                resizableColumnFit: true,
                layout: "fitColumns",
                columns: [ //주문일, 거래처, 제품명, 주문금액(부분합), 납기일, 상태, 인쇄
                    { title: "주문일", field: "odDt", width: 150, hozAlign: "center" },
                    { title: "거래처", field: "cliName", width: 180, hozAlign: "center" },
                    { title: "거래처 담당자", field: "cliChg", width: 180, hozAlign: "center" },
                    { title: "제품명", field: "pdName", width: 180, hozAlign: "center" },
                    { title: "주문금액", field: "detailPrice", width: 170, hozAlign: "center" },
                    { title: "납기일", field: "dueDt", width: 150, hozAlign: "center" },
                    { title: "상태", field: "odDetailSt", width: 170, hozAlign: "center" },
                    // { title: "인쇄", field: "week", width: 160, hozAlign: "center" }
                ],
            });

            var lotStockTable = new Tabulator("#lotStockTable", {
                // layout:"fitColumns",
                height: "100%",
                responsiveLayout: "hide",
                rowHeader: { formatter: "rownum", headerSort: false, width: 70, hozAlign: "center", resizable: false, frozen: true },
                resizableColumnFit: true,
                layout: "fitColumns",
                columns: [ //주문일, 거래처, 제품명, 주문금액(부분합), 납기일, 상태, 인쇄
                    { title: "주문일", field: "odDt", width: 150, hozAlign: "center" },
                    { title: "거래처", field: "cliName", width: 180, hozAlign: "center" },
                    { title: "거래처 담당자", field: "cliChg", width: 180, hozAlign: "center" },
                    { title: "제품명", field: "pdName", width: 180, hozAlign: "center" },
                    { title: "주문금액", field: "detailPrice", width: 170, hozAlign: "center" },
                    { title: "납기일", field: "dueDt", width: 150, hozAlign: "center" },
                    { title: "상태", field: "odDetailSt", width: 170, hozAlign: "center" },
                    // { title: "인쇄", field: "week", width: 160, hozAlign: "center" }
                ],
            });

        </script>
    </div>


</body>

</html>