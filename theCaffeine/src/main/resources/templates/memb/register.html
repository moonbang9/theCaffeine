<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/member}">
<head>
<meta charset="UTF-8">
<title>register</title>
</head>
  <body>
  <div layout:fragment="subscribe">
                
    <!-- Content -->

    <div class="container-xxl">
      <div class="authentication-wrapper authentication-basic container-p-y">
        <div class="authentication-inner">
          <!-- Register Card -->
          <div class="card">
            <div class="card-body">
              <!-- Logo -->
              <div class="app-brand justify-content-center">
                <a href="index.html" class="app-brand-link gap-2">
                  <span class="app-brand-logo demo">
                  </span>
                  <img src="/assets/img/favicon/1.png" width="150px" style="border-radius: 100px" >
                </a>
              </div>
              <!-- /Logo -->
              <form id="formAuthentication" class="mb-3" action="index.html" method="POST">
                <div class="mb-3">
                  <label for="username" class="form-label">아이디*</label>
                  <input
                    type="text"
                    class="form-control"
                    id="userid"
                    name="userid"
                    placeholder="아이디"
                    autofocus
                  />
                </div>
                <div class="mb-3 form-password-toggle">
                  <label class="form-label" for="userpw">비밀번호*</label>
                  <div class="input-group input-group-merge">
                    <input
                      type="password"
                      id="userpw"
                      class="form-control"
                      name="userpw"
                      placeholder="비밀번호"
                      aria-describedby="password"
                    />
                    <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                  
                  <div class="input-group input-group-merge">
                <input
                      type="password"
                      id="checkpw"
                      class="form-control"
                      name="checkpw"
                      placeholder="비밀번호 확인"
                      aria-describedby="password"
                    />
                    <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                    </div>
                  </div>
                  </div>
                  <br>
                  <p><small>▷기업정보</small></p>
                <div class="mb-2">
                  <label for="bussNo" class="form-label">사업자 등록번호*</label>
                  <div class="input-group">
			        <input type="text" class="form-control" id="bussNo" name="bussNo" placeholder="-없이 숫자만 입력" />
			        <button type="button" class="btn btn-primary" style="border-radius: 5px;" id="checkBussNo">인증</button>
			    </div>
                  <br>
                  <label for="bussName" class="form-label">사업자 명*</label>
                  <input type="text" class="form-control" id="bussName" name="bussName" placeholder="기업명 입력"  />
                  <label for="level" class="form-label">대표자</label>
                  <input type="text" class="form-control" id="ceo" name="ceo" placeholder="대표자명 입력"  />
                  </div>
                  <div class="mb-2">
                    <br>
                  <p><small>▷담당자 정보</small></p>
                  <label for="chgname" class="form-label">이름*</label>
                  <input type="text" class="form-control" id="chgname" name="chgname" placeholder="이름 입력"  />
                  <label for="email" class="form-label">이메일*</label>
                  <input type="text" class="form-control" id="email" name="email" placeholder="이메일 주소 입력"  />
                  
                  

                </div>
                <button class="btn btn-primary d-grid w-100">회원가입</button>
              </form>

        
            </div>
          </div>
          <!-- Register Card -->
        </div>
      </div>

    </div>
<script>

document.getElementById('checkBussNo').addEventListener("click", function() {
    checkBusinessNumber();
});
		//사업자번호 인증 api
        function checkBusinessNumber() {
            var bussNumber = document.getElementById('bussNo').value; // 사업자 번호 확인
            fetch('https://www.data.go.kr/data/15081808/openapi.do?businessNumber=' + bussNumber)
                .then(function (res) {
                    if (!res.ok) {
                        throw new Error('인증 실패');
                    }
                    return res.json();
                })
                .then(function (data) {
                    console.log(data);
                    alert('인증되었습니다!');
                })
                .catch(function (error) {
                    console.error('error:', error);
                });
        }

        function validateAndRegister() {
            var id = document.getElementById('userid').value;
            var pw = document.getElementById('userpw').value;
            var bussno = document.getElementById('bussNo').value;
            var enterName = document.getElementById('bussName').value;
            var chg = document.getElementById('chgname').value;
            var mail = document.getElementById('email').value;
           	var ceo = document.getElementById('ceo').value;
           

            if (!userid || !userpw || !checkpw || !bussNo || !bussName || !chgname || !email ) {
                alert("필수 값을 입력해주세요");
                return;
            }

            if (userpw !== checkpw) {
                alert("패스워드가 일치하지 않습니다");
                return;
            }
          
            	const form = {
                        id: document.getElementById('userid').value,
                        pw: document.getElementById('userpw').value,
                        bussno: document.getElementById('bussNo').value,
                        entername: document.getElementById('bussName').value,
                        chg: document.getElementById('chgname').value,
                        mail: document.getElementById('email').value,
                        ceo: document.getElementById('ceo').value
                    };

                    fetch('/memb/insert', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(form)
                    })
                    .then(res => res.json())
					.then(res => saveRes(res))
        }
         // 등록 응답
        	function saveRes(res) {
        		alert("회원가입이 완료되었습니다.");
        		location.href= "/memb/login"
        	}
    </script>
    </div>
    <!-- / Content -->

  </body>
</html>
